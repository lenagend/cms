spring:
  threads:
    virtual:
      enabled: true
  data:
    redis:
      host: localhost
      port: 6379
  # JPA 설정 추가 (DDL 자동 생성을 위해 필수)
  jpa:
    hibernate:
      ddl-auto: update # 개발 단계: update, 운영: validate 권장
    show-sql: true

cms:
  # [1. 중앙 캐시 정책 관리] (New)
  # 모든 모듈의 캐시 설정(TTL, MaxSize 등)을 여기서 통합 관리합니다.
  cache:
    # 시스템 전반의 캐시 저장소 모드 (LOCAL 또는 REDIS)
    mode: LOCAL
    # 기본 정책 (별도 설정 없는 캐시가 따름)
    default-policy:
      ttl: 10m
      max-size: 1000

    # 캐시별 상세 정책 정의
    policies:
      # 테넌트 메타데이터용 (기존 TenantProperties에서 이동)
      tenant_meta:
        ttl: 30m
        max-size: 5000
      # 다국어 메시지용 (기존 context.i18n에서 이동)
      i18n_messages:
        ttl: 60m
        max-size: 10000
  # [초기 관리자 및 보안 부트스트랩]
  # TODO: 상황에 맞게 커스텀 필요
  bootstrap:
    admin:
      email: "lenagend@naver.com"
      # 초기 비밀번호 (반드시 변경 권장)
      password: "1234"
      nickname: "SuperAdmin"
    tenant:
      # [보안 전략] 흔한 'ADMIN' 대신 예측 불가능한 코드를 사용하여 공격 표면을 줄입니다.
      site-code: "M_CONSOLE"
      # 관리자 접속 경로 (이 도메인으로 접속해야만 관리자 권한 행사 가능)
      domain: "console.localhost"
      name: "Master Console"

    # 관리자 페이지 접근 허용 IP 목록 (CIDR 지원)
    admin-ip-allowlist:
      - "127.0.0.1"
      - "0:0:0:0:0:0:0:1" # IPv6 Localhost
      # - "192.168.0.0/24" # 사내망 예시
  async:
    thread-name-prefix: "cms-vt-"

  # [보안 통합 설정]
  security:

    # 1. 자동 로그인 (SecurityProperties 매핑)
    remember-me:
      key: "mingchico-cms-secret-key-must-change" #프로덕션에서는 커스텀
      validity-seconds: 1209600 # 14일

    # 2. XSS 방어 (XssProperties 매핑)
    # 기존 'spring.security.xss' -> 'cms.security.xss'로 이동하여 통일성 확보
    xss:
      enabled: true
      rules:
        - path-pattern: "/admin/board/**"
          allow-parameters: [ "content" ]
        - path-pattern: "/admin/contents/**"
          allow-parameters: [ "content", "body" ]

    # 3. Rate Limit (RateLimitProperties 매핑)
    rate-limit:
      enabled: true
      capacity: 100
      trusted-proxies:
        - "127.0.0.1"
        - "0:0:0:0:0:0:0:1"
      excluded-paths:
        - "/actuator"
        - "/health"
        - "/metrics"
      excluded-extensions:
        - ".css"
        - ".js"
        - ".png"
        - ".jpg"
        - ".jpeg"
        - ".gif"
        - ".ico"
        - ".svg"
        - ".woff"
        - ".woff2"
        - ".ttf"
        - ".webp"

      # 세션 제어 설정
      session:
        default-limit: 1        # 기본 허용 세션 수
        role-limits:
          ADMIN: 1           # -1은 무제한
          MANAGER: 5
          USER: 1
        siteLimits:
          ENTERPRISE_SITE: 10    # 특정 테넌트(사이트코드) 대응

  tenant:
    excluded-paths:
      - "/favicon.ico"        # 파비콘
      - "/error"              # 에러 페이지
      - "/static/**"          # 정적 리소스 (css, js 등)
      - "/actuator/**"        # 헬스 체크 및 메트릭
      - "/api/admin/**"       # 관리자 API는 테넌트 무관
      - "/h2-console/**"      # H2 콘솔 (테스트용)
      -
  #콘텍스트 홀더 설정
  context:
    channel:
      admin-api-prefix: "/api/admin"
      api-prefix: "/api"
      admin-prefix: "/admin"